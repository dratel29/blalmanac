{% extends 'AppBundle::layout.html.twig' %}

{% block head %}{% endblock %}

{% block body %}

<div id="body">
    {{ include('AppBundle:Default:_body.html.twig') }}
</div>

{% endblock %}

{% block script %}
    <script type="text/javascript">

        $(document).ready(function () {
            setInterval(function () {
                refreshRoomStatuses();
            }, 30000);
            refreshRoomStatuses();
        });

        function refreshRoomStatuses() {

            $('#space').html($('#wait').html() + '<br/>');

            $.get('{{ path('status', {criteria: criteria}) }}', function (data) {
                if (data.redirect !== null) {
                    window.location = data.redirect;
                    return;
                }

                $('#body').html(data.body);
                $('#space').html('&nbsp;');
            });
        }

    </script>
{% endblock %}

{#

                $.each(data.statuses, function (id, room) {
                    $('#' + id + ' .room-event').html('');
                    $('#' + id + ' .room').css('background-color', null);

                    if (room.availability === null) {
                        $('#' + id + ' .room-details').html('<center><em>Information not available</em></center>');
                    } else {
                        var isFree = room.availability.status === 'free';

                        if (isFree) {

                            // there will be an event today
                            if (room.availability.event !== null) {

                                // Green (free room)
                                $('#' + id + ' .room').css('background-color', '#BBFFBB');

                                // Meeting in the next 30 mins: Yellow
                                if (room.availability.event.start - data.time < 1800) {
                                    $('#' + id + ' .room').css('background-color', '#FFFFAA');
                                }

                            } else {

                                // Blue (free room)
                                $('#' + id + ' .room').css('background-color', '#CCCCFF');
                            }

                        } else {
                            // Red (busy room)
                            $('#' + id + ' .room').css('background-color', '#FFCCCC');
                        }

                        if (room.availability.event !== null) {
                            $('#' + id + ' .room-event-time').html(room.availability.event.start_f + ' - ' + room.availability.event.end_f);
                        }
                    }
                });

                #}